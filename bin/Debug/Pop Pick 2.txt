SELECT (SELECT CASE
                 WHEN Sum(CASE
                            WHEN b.qty > i.qty_on_hand THEN 1
                            ELSE 0
                          END) > 0 THEN 'X'
                 ELSE ''
               END
        FROM   imordbld_wv b
               INNER JOIN iminvloc_sql i ON i.item_no = b.item_no
                                            AND i.loc = b.loc
        WHERE  b.ord_type = 'P'
               AND b.ord_no = ppordfil_wv.ord_no) AS Shortage,
       im.p_and_ic_cd,
       il.active_ords,
       il.avg_cost,
       il.byr_plnr,
       il.cycle_count_cd,
       il.discs_apply_fg,
       il.last_cost,
       il.loc_qty_fld,
       il.picking_seq,
       il.prev_status,
       il.price,
       il.prices_apply_flag,
       il.qty_allocated,
       il.qty_bkord,
       il.qty_on_hand,
       il.qty_on_ord,
       il.recom_min_ord,
       il.reorder_lvl,
       il.rollup_prc,
       il.safety_fctr,
       il.safety_stk,
       il.sls_price,
       oh.apply_to_no,
       oh.ar_reference,
       oh.ar_terms_cd,
       oh.bal_meth,
       oh.bill_to_addr_1,
       oh.bill_to_addr_2,
       oh.bill_to_addr_3,
       oh.bill_to_addr_4,
       oh.bill_to_city,
       oh.bill_to_country,
       oh.bill_to_name,
       oh.bill_to_no,
       oh.bill_to_state,
       oh.bill_to_zip,
       oh.cus_alt_adr_cd,
       oh.cus_no,
       oh.ship_to_addr_1,
       oh.ship_to_addr_2,
       oh.ship_to_addr_3,
       oh.ship_to_addr_4,
       oh.ship_to_city,
       oh.ship_to_country,
       oh.ship_to_name,
       oh.ship_to_state,
       oh.ship_to_zip,
       oh.ship_via_cd,
       oh.shipping_dt,
       oh.slspsn_no,
       oh.slspsn_no_2,
       oh.slspsn_no_3,
       oh.status AS oe_status,
       ol.forced_demand,
       ol.po_ord_no,
       ol.qty_ordered,
       ol.qty_return_to_stk,
       ol.qty_to_ship,
       ol.reason_cd,
       ol.req_ship_dt,
       ol.request_dt,
       ol.ser_lot_cd,
       ol.warranty_date,
       ppordfil_wv.byr_plnr,
       ppordfil_wv.cus_name,
       ppordfil_wv.cus_no,
       ppordfil_wv.drawing_rel_no,
       ppordfil_wv.drawing_rev_no,
       ppordfil_wv.due_dt,
       ppordfil_wv.end_item_cd,
       ppordfil_wv.entered_dt,
       ppordfil_wv.item_desc_1,
       ppordfil_wv.item_desc_2,
       ppordfil_wv.item_no,
       ppordfil_wv.job_no,
       ppordfil_wv.last_item_rev,
       ppordfil_wv.last_trx_dt,
       ppordfil_wv.loc,
       ppordfil_wv.open_flag,
       ppordfil_wv.ord_no,
       ppordfil_wv.ord_qty,
       ppordfil_wv.ord_rpt_fg,
       ppordfil_wv.ord_status,
       ppordfil_wv.ord_type,
       ppordfil_wv.org_count,
       ppordfil_wv.org_item_no,
       ppordfil_wv.org_lev,
       ppordfil_wv.org_multiplier,
       ppordfil_wv.org_ord_no,
       ppordfil_wv.par_ctl_no,
       ppordfil_wv.par_lev_no,
       ppordfil_wv.par_line_no,
       ppordfil_wv.par_ord_no,
       ppordfil_wv.par_ord_type,
       ppordfil_wv.par_seq_no,
       ppordfil_wv.rel_dt,
       ppordfil_wv.report_qty,
       ppordfil_wv.selected_fg,
       ppordfil_wv.ser_lot_fg,
       ppordfil_wv.src_line_no,
       ppordfil_wv.src_ord_no,
       ppordfil_wv.src_ord_type,
       ppordfil_wv.src_pkg_id,
       ppordfil_wv.start_dt,
       ppordfil_wv.unit_cost,
       ppordfil_wv.unit_price,
       ol.item_desc_2
FROM   ppordfil_wv
       INNER JOIN iminvloc_wv il ON il.item_no = ppordfil_wv.item_no
                                    AND il.loc = ppordfil_wv.loc
       INNER JOIN imitmidx_sql im ON im.item_no = ppordfil_wv.item_no
       LEFT OUTER JOIN oeordhdr_wv oh ON oh.ord_no = ppordfil_wv.src_ord_no
       LEFT OUTER JOIN oeordlin_wv ol ON ol.ord_no = ppordfil_wv.src_ord_no
                                         AND ol.line_no = ppordfil_wv.src_line_no
WHERE  ppordfil_wv.ord_status IN ( 'U', 'R' )
       AND ppordfil_wv.user_def_fld_5 IS NULL
ORDER  BY ppordfil_wv.ord_no 